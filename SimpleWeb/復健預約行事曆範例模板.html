<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>復健預約行事曆</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    <style>
        body {
            background-color: #f5f5f5;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
        }
        .main-container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin: 30px auto;
            max-width: 1400px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a90e2;
        }
        .page-title {
            color: #333;
            font-size: 32px;
            font-weight: bold;
            margin: 0;
        }
        .btn-back {
            background-color: #6c757d;
            color: white;
            padding: 10px 25px;
        }
        .btn-back:hover {
            background-color: #5a6268;
            color: white;
        }
        .legend-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .legend-pending { background-color: #4a90e2; }
        .legend-completed { background-color: #28a745; }
        .legend-cancelled { background-color: #6c757d; }
        .legend-leave { background-color: #dc3545; }
        
        #calendar {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        /* FullCalendar 自訂樣式 */
        .fc {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
        }
        .fc-event {
            cursor: pointer;
            border: none;
            padding: 2px 4px;
        }
        .fc-event-title {
            font-weight: bold;
        }
        .fc-daygrid-event {
            white-space: normal !important;
        }
        .fc-timegrid-event {
            border-radius: 4px;
        }
        
        /* 事件顏色 */
        .event-pending {
            background-color: #4a90e2 !important;
            border-color: #357abd !important;
        }
        .event-completed {
            background-color: #28a745 !important;
            border-color: #218838 !important;
        }
        .event-cancelled {
            background-color: #6c757d !important;
            border-color: #5a6268 !important;
        }
        .event-leave {
            background-color: #dc3545 !important;
            border-color: #c82333 !important;
        }
        
        /* Modal 樣式 */
        .modal-header {
            background-color: #4a90e2;
            color: white;
        }
        .detail-row {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .detail-label {
            font-weight: bold;
            color: #495057;
            width: 120px;
            display: inline-block;
        }
        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            display: inline-block;
        }
        .status-pending { background-color: #4a90e2; color: white; }
        .status-completed { background-color: #28a745; color: white; }
        .status-cancelled { background-color: #6c757d; color: white; }
        .status-leave { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="page-header">
            <h1 class="page-title">復健預約行事曆</h1>
            <button type="button" class="btn btn-back" onclick="goBack()">
                <i class="bi bi-arrow-left"></i> 返回清單
            </button>
        </div>

        <!-- 圖例說明 -->
        <div class="legend-container">
            <div class="legend-item">
                <div class="legend-color legend-pending"></div>
                <span>未看診</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-completed"></div>
                <span>完成看診</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-cancelled"></div>
                <span>已取消</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-leave"></div>
                <span>請假時段</span>
            </div>
        </div>

        <!-- 行事曆 -->
        <div id="calendar"></div>
    </div>

    <!-- 事件詳情 Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalTitle">預約詳情</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="eventModalBody">
                    <!-- 內容會由 JavaScript 動態填入 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary" onclick="editEvent()">編輯</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.10/locales/zh-tw.global.min.js'></script>
    <script>
        let calendar;
        let currentEvent = null;

        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                locale: 'zh-tw',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: '今天',
                    month: '月',
                    week: '週',
                    day: '日'
                },
                slotMinTime: '08:00:00',
                slotMaxTime: '18:00:00',
                slotDuration: '00:30:00',
                height: 'auto',
                navLinks: true,
                editable: false,
                selectable: true,
                nowIndicator: true,
                allDaySlot: false,
                
                // DEMO 事件資料
                events: [
                    // 預約資料
                    {
                        id: '1',
                        title: '王小明',
                        start: '2025-11-13T09:00:00',
                        end: '2025-11-13T09:30:00',
                        className: 'event-pending',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'A123456',
                            patientName: '王小明',
                            status: 'pending',
                            statusText: '未看診',
                            duration: '30',
                            note: '初診'
                        }
                    },
                    {
                        id: '2',
                        title: '李小華',
                        start: '2025-11-13T09:30:00',
                        end: '2025-11-13T10:00:00',
                        className: 'event-completed',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'B789012',
                            patientName: '李小華',
                            status: 'completed',
                            statusText: '完成看診',
                            duration: '30',
                            note: '複診'
                        }
                    },
                    {
                        id: '3',
                        title: '張小英',
                        start: '2025-11-13T10:00:00',
                        end: '2025-11-13T10:45:00',
                        className: 'event-pending',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'C345678',
                            patientName: '張小英',
                            status: 'pending',
                            statusText: '未看診',
                            duration: '45',
                            note: '-'
                        }
                    },
                    {
                        id: '4',
                        title: '陳小強',
                        start: '2025-11-13T10:30:00',
                        end: '2025-11-13T11:00:00',
                        className: 'event-cancelled',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'D901234',
                            patientName: '陳小強',
                            status: 'cancelled',
                            statusText: '已取消',
                            duration: '30',
                            note: '患者取消'
                        }
                    },
                    // 請假資料
                    {
                        id: 'leave1',
                        title: '請假 - 休息',
                        start: '2025-11-13T14:00:00',
                        end: '2025-11-13T15:00:00',
                        className: 'event-leave',
                        extendedProps: {
                            type: 'leave',
                            reason: '個人事務',
                            duration: '60'
                        }
                    },
                    {
                        id: '5',
                        title: '林小芳',
                        start: '2025-11-13T11:00:00',
                        end: '2025-11-13T11:30:00',
                        className: 'event-pending',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'E567890',
                            patientName: '林小芳',
                            status: 'pending',
                            statusText: '未看診',
                            duration: '30',
                            note: '複診'
                        }
                    },
                    {
                        id: '6',
                        title: '黃小龍',
                        start: '2025-11-13T11:30:00',
                        end: '2025-11-13T12:30:00',
                        className: 'event-completed',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'F123789',
                            patientName: '黃小龍',
                            status: 'completed',
                            statusText: '完成看診',
                            duration: '60',
                            note: '-'
                        }
                    },
                    // 其他日期的預約
                    {
                        id: '7',
                        title: '吳小美',
                        start: '2025-11-14T09:00:00',
                        end: '2025-11-14T09:30:00',
                        className: 'event-pending',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'G456123',
                            patientName: '吳小美',
                            status: 'pending',
                            statusText: '未看診',
                            duration: '30',
                            note: '初診'
                        }
                    },
                    {
                        id: '8',
                        title: '周小傑',
                        start: '2025-11-14T10:00:00',
                        end: '2025-11-14T10:45:00',
                        className: 'event-pending',
                        extendedProps: {
                            type: 'appointment',
                            medicalId: 'H789456',
                            patientName: '周小傑',
                            status: 'pending',
                            statusText: '未看診',
                            duration: '45',
                            note: '-'
                        }
                    },
                    // 週四請假
                    {
                        id: 'leave2',
                        title: '請假 - 進修',
                        start: '2025-11-14T13:00:00',
                        end: '2025-11-14T17:00:00',
                        className: 'event-leave',
                        extendedProps: {
                            type: 'leave',
                            reason: '參加研討會',
                            duration: '240'
                        }
                    }
                ],
                
                // 點擊事件
                eventClick: function(info) {
                    currentEvent = info.event;
                    showEventDetails(info.event);
                },
                
                // 時間格式
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                }
            });
            
            calendar.render();
        });

        // 顯示事件詳情
        function showEventDetails(event) {
            const props = event.extendedProps;
            const modal = new bootstrap.Modal(document.getElementById('eventModal'));
            
            let content = '';
            
            if (props.type === 'appointment') {
                // 預約詳情
                const statusClass = `status-${props.status}`;
                content = `
                    <div class="detail-row">
                        <span class="detail-label">病歷號：</span>
                        <span>${props.medicalId}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">姓名：</span>
                        <span>${props.patientName}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">開始時間：</span>
                        <span>${formatDateTime(event.start)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">結束時間：</span>
                        <span>${formatDateTime(event.end)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">復健時間：</span>
                        <span>${props.duration} 分鐘</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">狀態：</span>
                        <span class="status-badge ${statusClass}">${props.statusText}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">備註：</span>
                        <span>${props.note}</span>
                    </div>
                `;
                document.getElementById('eventModalTitle').textContent = '預約詳情';
            } else if (props.type === 'leave') {
                // 請假詳情
                content = `
                    <div class="detail-row">
                        <span class="detail-label">類型：</span>
                        <span class="status-badge status-leave">請假</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">開始時間：</span>
                        <span>${formatDateTime(event.start)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">結束時間：</span>
                        <span>${formatDateTime(event.end)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">請假時長：</span>
                        <span>${props.duration} 分鐘</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">原因：</span>
                        <span>${props.reason}</span>
                    </div>
                `;
                document.getElementById('eventModalTitle').textContent = '請假詳情';
            }
            
            document.getElementById('eventModalBody').innerHTML = content;
            modal.show();
        }

        // 格式化日期時間
        function formatDateTime(date) {
            if (!date) return '-';
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hour = String(d.getHours()).padStart(2, '0');
            const minute = String(d.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hour}:${minute}`;
        }

        // 編輯事件
        function editEvent() {
            if (currentEvent) {
                const props = currentEvent.extendedProps;
                if (props.type === 'appointment') {
                    alert(`編輯預約\n病歷號：${props.medicalId}\n姓名：${props.patientName}`);
                } else {
                    alert(`編輯請假\n原因：${props.reason}`);
                }
            }
        }

        // 返回清單頁面
        function goBack() {
            window.location.href = 'appointment_system.html';
        }
    </script>
</body>
</html>